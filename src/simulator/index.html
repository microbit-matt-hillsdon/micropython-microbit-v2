<!doctype html>
<html>
  <head>
    <title>Example simulator embedding</title>
    <style>
      body {
        display: flex;
      }
      iframe {
        width: 400px;
        height: 100vh;
      }
    </style>
  </head>
  <body>

    <iframe id="simulator" src="simulator.html" title="Simulator" frameborder="0" scrolling="no"></iframe>
    <div id="term"></div>
    <script src="term.js"></script>
    <script>
      // Connect the simulator REPL to a terminal.
      const simulator = document.querySelector("#simulator").contentWindow;
      const term = new Terminal({
        cols: 80,
        rows: 24,
        useStyle: true,
        screenKeys: true,
        cursorBlink: false
      });
      term.open(document.getElementById("term"));
      term.removeAllListeners('data');
      term.on('data', function(data) {
        simulator.postMessage({
          kind: "serial_input",
          data
        });
      });
      window.addEventListener("message", (e) => {
        switch (e.data.kind) {
          case "serial_output": {
            term.write(e.data.data);
            break;
          }
        }
      })
    </script>
  </body>
</html>
